/*global angular, FormData*/
/**!
* AngularJS file upload/drop directive with http post and progress
* @author Danial <danial.farid@gmail.com>
* @version 1.1.11
*/
(function() {
    'use strict';

    angular.module('fileUpload', []).directive('file', function ($http) {
        return {
            restrict: 'A',
            scope : {
                model : '='
            },
            link: function($scope, $element, attrs) {
                var config = {};

                config = {};
                config.url = attrs.url || '/';
                config.method = attrs.method || 'POST';

                config.headers = {};
                config.headers['Content-Type'] = undefined;
                config.transformRequest = angular.identity;

                $element.on('change', function(evt) {
                    config.data = new FormData();
                    config.data.append('file', evt.target.files[0]);
                    console.log(config);
                    $http(config).success(function (data) {
                        $scope.model = data;
                    });
                });
            }
        };
    });
})();
